<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment - Starbucks</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Arial', sans-serif;
    }
    
    body {
      background-color: #f1f8f5;
      padding: 20px;
      color: #2b2b2b;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
    
    .header {
      display: flex;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid #e5e5e5;
    }
    
    .logo {
      width: 50px;
      height: 50px;
      margin-right: 15px;
    }
    
    h1 {
      color: #006241;
      font-size: 28px;
      font-weight: 600;
    }
    
    h2 {
      color: #006241;
      margin: 25px 0 15px;
      font-size: 22px;
      padding-bottom: 10px;
      border-bottom: 1px solid #e5e5e5;
    }
    
    h3 {
      color: #006241;
      margin-bottom: 15px;
      font-size: 18px;
    }
    
    .order-summary {
      margin-bottom: 30px;
      background: #f9f9f9;
      border-radius: 10px;
      padding: 20px;
    }
    
    .order-item {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 15px 0;
      border-bottom: 1px solid #eee;
    }
    
    .order-item:last-child {
      border-bottom: none;
    }
    
    .item-info {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      flex: 1;
    }
    
    .item-info img {
      width: 70px;
      height: 70px;
      border-radius: 10px;
      object-fit: cover;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .item-details {
      flex: 1;
    }
    
    .item-details h3 {
      margin-bottom: 8px;
      color: #2b2b2b;
      font-size: 16px;
    }
    
    .item-details p {
      color: #666;
      font-size: 14px;
      margin-bottom: 5px;
    }
    
    .item-price {
      font-weight: bold;
      color: #006241;
      font-size: 16px;
    }
    
    .quantity {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 5px;
      color: #666;
      font-size: 14px;
    }
    
    .order-total {
      background-color: #f7f7f7;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
    }
    
    .total-line {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      font-size: 16px;
    }
    
    .total-line:last-child {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #ddd;
      font-weight: bold;
      font-size: 20px;
      color: #006241;
    }
    
    .address-section {
      margin: 25px 0;
    }
    
    .delivery-options {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .delivery-option {
      flex: 1;
      padding: 15px;
      border: 2px solid #e5e5e5;
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .delivery-option:hover {
      border-color: #006241;
    }
    
    .delivery-option.selected {
      border-color: #006241;
      background-color: #f1f8f5;
    }
    
    .delivery-option i {
      font-size: 24px;
      color: #006241;
      margin-bottom: 10px;
    }
    
    .address-form {
      background: #f9f9f9;
      border-radius: 10px;
      padding: 20px;
      margin-top: 20px;
    }
    
    .form-row {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .form-group {
      flex: 1;
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
      color: #555;
      font-weight: 500;
    }
    
    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
      transition: border 0.3s;
    }
    
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
      border-color: #006241;
      outline: none;
    }
    
    .form-group textarea {
      min-height: 80px;
      resize: vertical;
    }
    
    .payment-methods {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin: 25px 0;
    }
    
    .payment-card {
      border: 2px solid #e5e5e5;
      border-radius: 10px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .payment-card:hover {
      border-color: #006241;
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .payment-card.selected {
      border-color: #006241;
      background-color: #f1f8f5;
    }
    
    .payment-card h3 {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
      color: #006241;
    }
    
    .payment-card i {
      font-size: 24px;
    }
    
    .payment-form {
      margin-top: 15px;
      display: none;
    }
    
    .payment-card.selected .payment-form {
      display: block;
    }
    
    .reward-section {
      background: #f7f7f7;
      border-radius: 10px;
      padding: 20px;
      margin: 25px 0;
    }
    
    .reward-balance {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .reward-balance span {
      font-weight: bold;
      color: #006241;
    }
    
    .use-rewards {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    
    input:checked + .slider {
      background-color: #006241;
    }
    
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    
    .action-buttons {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 30px;
      gap: 15px;
    }
    
    .left-buttons {
      display: flex;
      gap: 15px;
    }
    
    .right-buttons {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 10px;
    }
    
    .back-btn, .pay-btn, .confirmed-btn {
      padding: 14px 28px;
      border-radius: 50px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      border: none;
    }
    
    .back-btn {
      background: white;
      color: #006241;
      border: 2px solid #006241;
    }
    
    .back-btn:hover {
      background: #f1f8f5;
    }
    
    .pay-btn {
      background: #006241;
      color: white;
      box-shadow: 0 4px 10px rgba(0, 98, 65, 0.3);
    }
    
    .pay-btn:hover {
      background: #004d34;
      transform: translateY(-2px);
    }
    
    .pay-btn:disabled {
      background: #ccc;
      box-shadow: none;
      cursor: not-allowed;
      transform: none;
    }
    
    .confirmed-btn {
      background: #28a745;
      color: white;
      box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3);
      display: none;
    }
    
    .confirmed-btn:hover {
      background: #218838;
      transform: translateY(-2px);
    }
    
    .saved-addresses {
      margin-bottom: 20px;
    }
    
    .saved-address {
      display: flex;
      align-items: center;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .saved-address:hover {
      border-color: #006241;
      background-color: #f9f9f9;
    }
    
    .saved-address.selected {
      border-color: #006241;
      background-color: #f1f8f5;
    }
    
    .saved-address i {
      margin-right: 15px;
      color: #006241;
      font-size: 20px;
    }
    
    .address-details {
      flex: 1;
    }
    
    .address-details h4 {
      margin-bottom: 5px;
      color: #2b2b2b;
    }
    
    .address-details p {
      color: #666;
      font-size: 14px;
      line-height: 1.4;
    }
    
    .bill-summary {
      background-color: #f7f7f7;
      border-radius: 10px;
      padding: 20px;
      margin: 25px 0;
    }
    
    .bill-line {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      font-size: 16px;
    }
    
    .bill-line:last-child {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #ddd;
      font-weight: bold;
      font-size: 20px;
      color: #006241;
    }
    
    @media (max-width: 768px) {
      .payment-methods, .delivery-options {
        grid-template-columns: 1fr;
        flex-direction: column;
      }
      
      .item-info {
        flex-direction: column;
        gap: 12px;
      }
      
      .item-info img {
        width: 60px;
        height: 60px;
      }
      
      .action-buttons, .form-row {
        flex-direction: column;
        gap: 10px;
      }
      
      .form-row {
        gap: 0;
      }
      
      .left-buttons, .right-buttons {
        width: 100%;
      }
      
      .right-buttons {
        align-items: stretch;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://www.starbucks.in/assets/icon/logo.png" alt="Starbucks Logo" class="logo">
      <h1>Payment & Delivery</h1>
    </div>
    
    <h2>Order Summary</h2>
    <div class="order-summary" id="orderSummary">
      <!-- Order items will be dynamically inserted here -->
    </div>
    
    <div class="order-total" id="orderTotalSection">
      <div class="total-line">
        <span>Subtotal</span>
        <span id="subtotal">‚Çπ 0.00</span>
      </div>
      <div class="total-line">
        <span>Delivery Fee</span>
        <span id="deliveryFee">‚Çπ 0.00</span>
      </div>
      <div class="total-line">
        <span>GST (8%)</span>
        <span id="tax">‚Çπ 0.00</span>
      </div>
      <div class="total-line">
        <span>Total</span>
        <span id="total">‚Çπ 0.00</span>
      </div>
    </div>
    
    <div class="address-section">
      <h2>Delivery Method</h2>
      <div class="delivery-options">
        <div class="delivery-option selected" id="delivery" onclick="selectDelivery('delivery')">
          <i class="fas fa-truck"></i>
          <h3>Delivery</h3>
          <p>Get your order delivered to your location</p>
        </div>
        <div class="delivery-option" id="pickup" onclick="selectDelivery('pickup')">
          <i class="fas fa-store"></i>
          <h3>Pickup</h3>
          <p>Pick up your order at a nearby store</p>
        </div>
      </div>
      
      <div id="addressForms">
        <!-- Delivery Address Form -->
        <div class="address-form" id="deliveryAddressForm">
          <h3>Delivery Address</h3>
          
          <div class="saved-addresses">
            <div class="saved-address selected" onclick="selectAddress(this)">
              <i class="fas fa-home"></i>
              <div class="address-details">
                <h4>Home Address</h4>
                <p>123 Coffee Lane, Brew District, Bengaluru, Karnataka 560001</p>
              </div>
            </div>
            <div class="saved-address" onclick="selectAddress(this)">
              <i class="fas fa-briefcase"></i>
              <div class="address-details">
                <h4>Work Address</h4>
                <p>456 Espresso Street, Corporate Park, Bengaluru, Karnataka 560002</p>
              </div>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="fullName">Full Name</label>
              <input type="text" id="fullName" placeholder="Enter your full name">
            </div>
            <div class="form-group">
              <label for="phone">Phone Number</label>
              <input type="tel" id="phone" placeholder="Enter your phone number">
            </div>
          </div>
          
          <div class="form-group">
            <label for="address">Street Address</label>
            <input type="text" id="address" placeholder="Enter your street address">
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="city">City</label>
              <input type="text" id="city" placeholder="Enter your city">
            </div>
            <div class="form-group">
              <label for="state">State</label>
              <select id="state">
                <option value="">Select State</option>
                <option value="KA">Karnataka</option>
                <option value="MH">Maharashtra</option>
                <option value="TN">Tamil Nadu</option>
                <option value="DL">Delhi</option>
                <option value="KL">Kerala</option>
                <option value="TS">Telangana</option>
                <option value="AP">Andhra Pradesh</option>
              </select>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="pincode">Pincode</label>
              <input type="text" id="pincode" placeholder="Enter pincode">
            </div>
            <div class="form-group">
              <label for="landmark">Landmark (Optional)</label>
              <input type="text" id="landmark" placeholder="Nearby landmark">
            </div>
          </div>
          
          <div class="form-group">
            <label for="deliveryInstructions">Delivery Instructions (Optional)</label>
            <textarea id="deliveryInstructions" placeholder="Any specific instructions for delivery"></textarea>
          </div>
        </div>
        
        <!-- Pickup Location Form -->
        <div class="address-form" id="pickupAddressForm" style="display: none;">
          <h3>Select Pickup Location</h3>
          
          <div class="form-group">
            <label for="storeLocation">Select Starbucks Store</label>
            <select id="storeLocation">
              <option value="">Select a store location</option>
              <option value="store1">Starbucks Central Square Mall</option>
              <option value="store2">Starbucks Phoenix Marketcity</option>
              <option value="store3">Starbucks Orion Mall</option>
              <option value="store4">Starbucks Forum Mall</option>
              <option value="store5">Starbucks Garuda Mall</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="pickupTime">Preferred Pickup Time</label>
            <input type="time" id="pickupTime" min="09:00" max="21:00">
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="pickupName">Name for Order</label>
              <input type="text" id="pickupName" placeholder="Enter your name">
            </div>
            <div class="form-group">
              <label for="pickupPhone">Phone Number</label>
              <input type="tel" id="pickupPhone" placeholder="Enter your phone number">
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="reward-section">
      <div class="reward-balance">
        <span>Starbucks Rewards Balance: 125 stars</span>
        <div class="use-rewards">
          <span>Use rewards</span>
          <label class="switch">
            <input type="checkbox" id="useRewards">
            <span class="slider"></span>
          </label>
        </div>
      </div>
      <p id="rewardsMessage">Earn 5 stars (‚Çπ25.00) with this purchase</p>
    </div>
    
    <!-- Bill Summary Section -->
    <div class="bill-summary">
      <h2>Bill Summary</h2>
      <div class="bill-line">
        <span>Items Total</span>
        <span id="billSubtotal">‚Çπ 0.00</span>
      </div>
      <div class="bill-line">
        <span>Delivery Fee</span>
        <span id="billDeliveryFee">‚Çπ 0.00</span>
      </div>
      <div class="bill-line">
        <span>Tax (GST 8%)</span>
        <span id="billTax">‚Çπ 0.00</span>
      </div>
      <div class="bill-line">
        <span>Rewards Discount</span>
        <span id="billDiscount">- ‚Çπ 0.00</span>
      </div>
      <div class="bill-line">
        <span>Total Amount</span>
        <span id="billTotal">‚Çπ 0.00</span>
      </div>
    </div>
    
    <h2>Select Payment Method</h2>
    <div class="payment-methods">
      <div class="payment-card" onclick="selectPayment('card')">
        <h3><i class="fas fa-credit-card"></i> Credit/Debit Card</h3>
        <div class="payment-form" id="cardForm">
          <div class="form-group">
            <label for="cardNumber">Card Number</label>
            <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456">
          </div>
          <div class="form-group">
            <label for="cardName">Name on Card</label>
            <input type="text" id="cardName" placeholder="John Doe">
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="expiry">Expiry Date</label>
              <input type="text" id="expiry" placeholder="MM/YY">
            </div>
            <div class="form-group">
              <label for="cvv">CVV</label>
              <input type="text" id="cvv" placeholder="123">
            </div>
          </div>
        </div>
      </div>
      
      <div class="payment-card" onclick="selectPayment('paypal')">
        <h3><i class="fab fa-paypal"></i> PayPal</h3>
        <div class="payment-form" id="paypalForm">
          <div class="form-group">
            <label for="paypalEmail">Email Address</label>
            <input type="email" id="paypalEmail" placeholder="your@email.com">
          </div>
        </div>
      </div>
      
      <div class="payment-card" onclick="selectPayment('upi')">
        <h3><i class="fas fa-mobile-alt"></i> UPI</h3>
        <div class="payment-form" id="upiForm">
          <div class="form-group">
            <label for="upiId">UPI ID</label>
            <input type="text" id="upiId" placeholder="yourname@upi">
          </div>
        </div>
      </div>
      
      <div class="payment-card" onclick="selectPayment('cash')">
        <h3><i class="fas fa-money-bill-wave"></i> Cash</h3>
        <div class="payment-form" id="cashForm">
          <p>Pay with cash when your order is delivered.</p>
        </div>
      </div>
    </div>
    
    <div class="action-buttons">
      <div class="left-buttons">
        <button class="back-btn" onclick="window.location.href='Index.html'">
          <i class="fas fa-arrow-left"></i> Back to Home
        </button>
        <button class="confirmed-btn" id="confirmedBtn" onclick="redirectToConfirmation()">
          <i class="fas fa-check-circle"></i> Confirmed
        </button>
      </div>
      <div class="right-buttons">
        <button class="pay-btn" id="payBtn" onclick="processPayment()">
          Confirm Payment <i class="fas fa-lock"></i>
        </button>
      </div>
    </div>
  </div>

  <script>
    // Function to extract price from string
    function extractPrice(priceStr) {
      // Remove currency symbol and commas, then parse as float
      return parseFloat(priceStr.replace(/[^\d.]/g, ''));
    }

    // Function to get cart from localStorage
    function getCartFromStorage() {
      try {
        return JSON.parse(localStorage.getItem('starbucksCart')) || [];
      } catch (e) {
        console.error('Error reading cart from localStorage:', e);
        return [];
      }
    }

    // Function to generate placeholder image based on product type
    function getPlaceholderImage(productName) {
      if (productName.toLowerCase().includes('coffee') || productName.toLowerCase().includes('latte') || 
          productName.toLowerCase().includes('espresso') || productName.toLowerCase().includes('cappuccino')) {
        return 'https://via.placeholder.com/70/8B4513/FFFFFF?text=‚òï';
      } else if (productName.toLowerCase().includes('sandwich') || productName.toLowerCase().includes('wrap') || 
                 productName.toLowerCase().includes('toast')) {
        return 'https://via.placeholder.com/70/DEB887/000000?text=ü•™';
      } else if (productName.toLowerCase().includes('mug') || productName.toLowerCase().includes('cup')) {
        return 'https://via.placeholder.com/70/FFD700/000000?text=üçµ';
      } else if (productName.toLowerCase().includes('bean') || productName.toLowerCase().includes('blend')) {
        return 'https://via.placeholder.com/70/8B4513/FFFFFF?text=üå∞';
      } else {
        return 'https://via.placeholder.com/70/006241/FFFFFF?text=‚òÖ';
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      // Retrieve cart from localStorage
      const cart = getCartFromStorage();
      const orderSummary = document.getElementById('orderSummary');
      const subtotalElement = document.getElementById('subtotal');
      const deliveryFeeElement = document.getElementById('deliveryFee');
      const taxElement = document.getElementById('tax');
      const totalElement = document.getElementById('total');
      const payBtn = document.getElementById('payBtn');
      const confirmedBtn = document.getElementById('confirmedBtn');
      const useRewards = document.getElementById('useRewards');
      const rewardsMessage = document.getElementById('rewardsMessage');
      
      // Bill summary elements
      const billSubtotal = document.getElementById('billSubtotal');
      const billDeliveryFee = document.getElementById('billDeliveryFee');
      const billTax = document.getElementById('billTax');
      const billDiscount = document.getElementById('billDiscount');
      const billTotal = document.getElementById('billTotal');
      
      if (cart.length === 0) {
        orderSummary.innerHTML = `
          <div class="empty-cart" style="text-align: center; padding: 40px;">
            <i class="fas fa-shopping-bag" style="font-size: 48px; color: #ccc; margin-bottom: 15px;"></i>
            <p style="font-size: 18px; color: #666; margin-bottom: 20px;">Your cart is empty</p>
            <button class="back-btn" onclick="window.location.href='Index.html'"><i class="fas fa-arrow-left"></i> Back to Home</button>
          </div>
        `;
        document.getElementById('orderTotalSection').style.display = 'none';
        document.querySelector('.bill-summary').style.display = 'none';
        payBtn.disabled = true;
      } else {
        let subtotal = 0;
        
        // Clear previous content
        orderSummary.innerHTML = '';
        
        cart.forEach((item, index) => {
          // Extract numeric price (handle both number and string formats)
          const price = typeof item.price === 'number' ? item.price : extractPrice(item.price);
          const itemTotal = price * item.quantity;
          subtotal += itemTotal;
          
          // Use the item's image if available, otherwise generate a placeholder
          const itemImage = item.image || getPlaceholderImage(item.name);
          
          const itemElement = document.createElement('div');
          itemElement.classList.add('order-item');
          itemElement.innerHTML = `
            <div class="item-info">
              <img src="${itemImage}" alt="${item.name}" onerror="this.src='${getPlaceholderImage(item.name)}'">
              <div class="item-details">
                <h3>${item.name}</h3>
                <p>${item.description || 'Delicious Starbucks item'}</p>
                <div class="quantity">Qty: ${item.quantity} √ó ‚Çπ${price.toFixed(2)}</div>
              </div>
            </div>
            <div class="item-price">‚Çπ ${itemTotal.toFixed(2)}</div>
          `;
          
          orderSummary.appendChild(itemElement);
        });
        
        updateTotals(subtotal, 'delivery');
        updateBillSummary(subtotal, 'delivery', false);
        payBtn.disabled = false;
      }
      
      // Toggle rewards message
      useRewards.addEventListener('change', function() {
        if (this.checked) {
          rewardsMessage.textContent = "Using 100 stars for ‚Çπ50.00 discount";
          updateTotalsWithDiscount();
          updateBillSummary(calculateSubtotal(), document.querySelector('.delivery-option.selected').id, true);
        } else {
          rewardsMessage.textContent = "Earn 5 stars (‚Çπ25.00) with this purchase";
          updateTotals(calculateSubtotal(), document.querySelector('.delivery-option.selected').id);
          updateBillSummary(calculateSubtotal(), document.querySelector('.delivery-option.selected').id, false);
        }
      });
    });

    function calculateSubtotal() {
      const cart = getCartFromStorage();
      let subtotal = 0;
      
      cart.forEach(item => {
        const price = typeof item.price === 'number' ? item.price : extractPrice(item.price);
        subtotal += price * item.quantity;
      });
      
      return subtotal;
    }

    function updateTotals(subtotal, deliveryType) {
      const deliveryFee = deliveryType === 'delivery' ? 40 : 0;
      const tax = (subtotal + deliveryFee) * 0.08; // Changed from 0.18 to 0.08 (8% GST)
      const total = subtotal + deliveryFee + tax;
      
      document.getElementById('subtotal').textContent = `‚Çπ ${subtotal.toFixed(2)}`;
      document.getElementById('deliveryFee').textContent = `‚Çπ ${deliveryFee.toFixed(2)}`;
      document.getElementById('tax').textContent = `‚Çπ ${tax.toFixed(2)}`;
      document.getElementById('total').textContent = `‚Çπ ${total.toFixed(2)}`;
    }

    function updateBillSummary(subtotal, deliveryType, useRewards) {
      const deliveryFee = deliveryType === 'delivery' ? 40 : 0;
      const tax = (subtotal + deliveryFee) * 0.08; // Changed from 0.18 to 0.08 (8% GST)
      const discount = useRewards ? 50 : 0;
      const total = subtotal + deliveryFee + tax - discount;
      
      billSubtotal.textContent = `‚Çπ ${subtotal.toFixed(2)}`;
      billDeliveryFee.textContent = `‚Çπ ${deliveryFee.toFixed(2)}`;
      billTax.textContent = `‚Çπ ${tax.toFixed(2)}`;
      billDiscount.textContent = `- ‚Çπ ${discount.toFixed(2)}`;
      billTotal.textContent = `‚Çπ ${total.toFixed(2)}`;
    }

    function updateTotalsWithDiscount() {
      const deliveryType = document.querySelector('.delivery-option.selected').id;
      const subtotal = calculateSubtotal();
      const deliveryFee = deliveryType === 'delivery' ? 40 : 0;
      const discount = 50; // ‚Çπ50 discount for 100 stars
      const discountedSubtotal = Math.max(0, subtotal - discount);
      const tax = (discountedSubtotal + deliveryFee) * 0.08; // Changed from 0.18 to 0.08 (8% GST)
      const total = discountedSubtotal + deliveryFee + tax;
      
      document.getElementById('subtotal').textContent = `‚Çπ ${subtotal.toFixed(2)}`;
      document.getElementById('subtotal').innerHTML += ` <span style="color: #d62b2b; font-size: 14px;">(-‚Çπ${discount.toFixed(2)})</span>`;
      document.getElementById('deliveryFee').textContent = `‚Çπ ${deliveryFee.toFixed(2)}`;
      document.getElementById('tax').textContent = `‚Çπ ${tax.toFixed(2)}`;
      document.getElementById('total').textContent = `‚Çπ ${total.toFixed(2)}`;
    }

    function selectDelivery(type) {
      // Remove selected class from all delivery options
      document.querySelectorAll('.delivery-option').forEach(option => {
        option.classList.remove('selected');
      });
      
      // Add selected class to the clicked option
      event.currentTarget.classList.add('selected');
      
      // Show the appropriate address form
      if (type === 'delivery') {
        document.getElementById('deliveryAddressForm').style.display = 'block';
        document.getElementById('pickupAddressForm').style.display = 'none';
      } else {
        document.getElementById('deliveryAddressForm').style.display = 'none';
        document.getElementById('pickupAddressForm').style.display = 'block';
      }
      
      // Update totals with delivery fee
      const subtotal = calculateSubtotal();
      const useRewards = document.getElementById('useRewards').checked;
      updateTotals(subtotal, type);
      updateBillSummary(subtotal, type, useRewards);
    }

    function selectAddress(element) {
      // Remove selected class from all addresses
      document.querySelectorAll('.saved-address').forEach(address => {
        address.classList.remove('selected');
      });
      
      // Add selected class to the clicked address
      element.classList.add('selected');
    }

    function selectPayment(method) {
      // Remove selected class from all payment cards
      document.querySelectorAll('.payment-card').forEach(card => {
        card.classList.remove('selected');
      });
      
      // Add selected class to the clicked payment card
      event.currentTarget.classList.add('selected');
    }

    function redirectToConfirmation() {
      // Redirect to the confirmation page
      window.location.href = 'confirm.html';
    }

    function processPayment() {
      const selectedPayment = document.querySelector('.payment-card.selected');
      const deliveryType = document.querySelector('.delivery-option.selected').id;
      const cart = getCartFromStorage();
      
      if (cart.length === 0) {
        alert('Your cart is empty!');
        return;
      }
      
      if (!selectedPayment) {
        alert('Please select a payment method');
        return;
      }
      
      // Validate address based on delivery type
      if (deliveryType === 'delivery') {
        const fullName = document.getElementById('fullName').value;
        const phone = document.getElementById('phone').value;
        const address = document.getElementById('address').value;
        const city = document.getElementById('city').value;
        const state = document.getElementById('state').value;
        const pincode = document.getElementById('pincode').value;
        
        if (!fullName || !phone || !address || !city || !state || !pincode) {
          alert('Please fill all required address fields');
          return;
        }
      } else {
        const storeLocation = document.getElementById('storeLocation').value;
        const pickupTime = document.getElementById('pickupTime').value;
        const pickupName = document.getElementById('pickupName').value;
        const pickupPhone = document.getElementById('pickupPhone').value;
        
        if (!storeLocation || !pickupTime || !pickupName || !pickupPhone) {
          alert('Please fill all required pickup details');
          return;
        }
      }
      
      // Simple validation based on payment method
      let isValid = true;
      let errorMessage = '';
      
      if (selectedPayment.querySelector('#cardForm')) {
        const cardNumber = document.getElementById('cardNumber').value;
        const cardName = document.getElementById('cardName').value;
        const expiry = document.getElementById('expiry').value;
        const cvv = document.getElementById('cvv').value;
        
        if (!cardNumber || !cardName || !expiry || !cvv) {
          isValid = false;
          errorMessage = 'Please fill all card details';
        } else if (cardNumber.replace(/\s/g, '').length !== 16) {
          isValid = false;
          errorMessage = 'Please enter a valid 16-digit card number';
        }
      } else if (selectedPayment.querySelector('#paypalForm')) {
        const paypalEmail = document.getElementById('paypalEmail').value;
        if (!paypalEmail) {
          isValid = false;
          errorMessage = 'Please enter your PayPal email';
        }
      } else if (selectedPayment.querySelector('#upiForm')) {
        const upiId = document.getElementById('upiId').value;
        if (!upiId) {
          isValid = false;
          errorMessage = 'Please enter your UPI ID';
        }
      }
      
      if (!isValid) {
        alert(errorMessage);
        return;
      }
      
      // Simulate payment processing
      document.getElementById('payBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
      document.getElementById('payBtn').disabled = true;
      
      setTimeout(() => {
        // Show the confirmed button above the payment button
        document.getElementById('confirmedBtn').style.display = 'block';
        
        // Reset the payment button
        document.getElementById('payBtn').innerHTML = 'Confirm Payment <i class="fas fa-lock"></i>';
        document.getElementById('payBtn').disabled = false;
        
        alert('Payment successful! Your order is being prepared.');
        
        // Get payment method name
        let paymentMethodName = 'Credit/Debit Card';
        if (selectedPayment.querySelector('#paypalForm')) {
          paymentMethodName = 'PayPal';
        } else if (selectedPayment.querySelector('#upiForm')) {
          paymentMethodName = 'UPI';
        } else if (selectedPayment.querySelector('#cashForm')) {
          paymentMethodName = 'Cash';
        }
        
        // Calculate total amount
        const subtotal = calculateSubtotal();
        const deliveryFee = deliveryType === 'delivery' ? 40 : 0;
        const tax = (subtotal + deliveryFee) * 0.08;
        const totalAmount = (subtotal + deliveryFee + tax).toFixed(2);
        
        // Save complete order data to localStorage
        const orderData = {
          items: cart,
          orderNumber: 'SB' + Math.floor(100000 + Math.random() * 900000),
          paymentMethod: paymentMethodName,
          deliveryType: deliveryType,
          totalAmount: totalAmount
        };
        
        localStorage.setItem('starbucksOrder', JSON.stringify(orderData));
        
        // Clear cart after successful payment
        localStorage.removeItem('starbucksCart');
      }, 2000);
    }
  </script>
</body>
</html>